<!DOCTYPE html>
<html>
<head>
    <title>ERAM | System Logon</title>
<link href="indexstyle.css" rel="stylesheet">
</head>
<body>
    <h1>NAS ERAM STATUS</h1>
    <div id="status-text" style="margin-bottom: 20px;">CONNECTING TO SERVER...</div>
    <div class="grid" id="sector-grid"></div>

    <div id="login-overlay">
        <div class="login-box">
            <h2 id="selected-title" style="color:#00ffff"></h2>
            <input type="text" id="initials" placeholder="INITIALS" maxlength="2">
            <br>
            <input type="text" id="cid" placeholder="CID" maxlength="3">
            <br>
            <button id="go" onclick="logOn()">LOG ON</button>
            <p onclick="location.reload()" style="color:red; cursor:pointer;">[ CANCEL ]</p>
        </div>
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
    const socket = io();
    const sectors = {
        IRCC: "Rockford Center", ICCC: "Cyprus Center", IZCC: "Izolrani Center",
        IOCC: "Tokyo Center", IPCC: "Perth Center", IBCC: "Sotaf Center",
        IGCC: "Grindavik Center", ISCC: "Sauthemptona Center"
    };
    let activeSector = "";

    socket.on('connect', () => {
        document.getElementById('status-text').innerText = "LINK ESTABLISHED";
        socket.emit('checkAvailability');
    });

    socket.on('availabilityStatus', (status) => {
    document.getElementById('status-text').style.display = 'none';
    const grid = document.getElementById('sector-grid');
    grid.innerHTML = "";

    for (let code in sectors) {
        const info = status[code] || { taken: false };
        const isTaken = info.taken;

        const btn = document.createElement('div');
        btn.className = `sector-btn ${isTaken ? 'disabled' : ''}`;
        
        // Build the base content
        let content = `
            <b>${code}</b> - ${sectors[code]}
            <span class="status-tag" style="color: ${isTaken ? 'red' : 'lime'}">
                ${isTaken ? 'BUSY (' + info.holder + ')' : 'OPEN'}
            </span>
        `;

        // GLOBAL OVERRIDE: If it's taken, add the admin link to any sector
        if (isTaken) {
            content += `
                <div onclick="openLogin('${code}')" 
                     style="color: orange; text-decoration: underline; margin-top: 10px; cursor: pointer; font-size: 0.8em;">
                    [ ADMIN OVERRIDE ]
                </div>
            `;
        }

        btn.innerHTML = content;

        // Normal click logic for open sectors
        if (!isTaken) {
            btn.onclick = () => openLogin(code);
        }
        
        grid.appendChild(btn);
    }
});

    function openLogin(code) {
        activeSector = code;
        document.getElementById('selected-title').innerText = sectors[code];
        document.getElementById('login-overlay').style.display = "flex";
    }

    function logOn() {
        const init = document.getElementById('initials').value.toUpperCase();
        const cid = document.getElementById('cid').value;
        if (!init || !cid) return alert("Fields required");

        // Explicit file mapping
        const fileMap = {
            'IRCC': 'artcc/rockford.html', 
            'ICCC': 'artcc/cyprus.html', 
            'IZCC': 'artcc/izolrani.html',
            'IOCC': 'artcc/tokyo.html', 
            'IPCC': 'artcc/perth.html', 
            'IBCC': 'artcc/sotaf.html',
            'IGCC': 'artcc/grindavik.html', 
            'ISCC': 'artcc/sauthemptona.html'
        };

        const targetFile = fileMap[activeSector];
        
        if (!targetFile) {
            alert("Error: Sector file not found.");
            return;
        }

        // Redirect with all params
        window.location.href = `/${targetFile}?init=${init}&cid=${cid}&sector=${activeSector}`;
    }
</script>
</body>
</html>